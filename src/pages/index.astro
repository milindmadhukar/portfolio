---
import Layout from "../layouts/Layout.astro";
import { getGithubUpdatedAt } from "../lib/utils";
import TerminalPrompt from "../components/TerminalPrompt.astro";
import DiscordStatus from "../components/DiscordStatus";
import { personalInfo, experience, education } from "../data/portfolio";

const githubUpdatedAt = await getGithubUpdatedAt();
---

<Layout title="portfolio@milind.dev" includePadding={true}>
	<div
		id="terminal-container"
		class="font-mono text-xs sm:text-sm md:text-base leading-tight z-10 min-h-[100vh]"
	>
		<div class="mb-4">
			<TerminalPrompt user="portfolio" host="milind.dev">
				<span id="typewriter" class="text-ctp-text"></span><span
					id="cursor"
					class="text-ctp-text animate-pulse">â–ˆ</span
				>
			</TerminalPrompt>
		</div>

		<div id="fetch-output" class="hidden">
			<div
				class="flex flex-col lg:flex-row gap-10 items-center lg:items-start w-fit"
			>
				<div class="select-none text-ctp-blue font-bold">
					<pre>                   -`
                  .o+`
                 `ooo/
                `+oooo:
               `+oooooo:
               -+oooooo+:
             `/:-:++oooo+:
            `/++++/+++++++:
           `/++++++++++++++:
          `/+++ooooooooooooo/`
         ./ooosssso++osssssso+`
        .oossssso-````/ossssss+`
       -osssssso.      :ssssssso.
      :osssssss/        osssso+++.
     /ossssssss/        +ssssooo/-
   `/ossssso+/:-        -:/+osssso+-
  `+sso+:-`                 `.-/+oso:
 `++:.                           `-/+/
 .`                                 `/
          </pre>
				</div>

				<div class="flex flex-col gap-[2px]">
					<div class="mb-2">
						<span class="text-ctp-red">portfolio</span><span
							class="text-ctp-overlay2">@</span
						><span class="text-ctp-teal">milind.dev</span>
					</div>
					<div class="text-ctp-overlay1">
						--------------------------
					</div>
					<div>
						<span class="text-ctp-blue"
							><i class="nf nf-md-map_marker"></i> Role</span
						>
						<span> : DevOps & Backend Engineer</span>
					</div>
					<div>
						<span class="text-ctp-blue"
							><i class="nf nf-fa-building"></i> Work</span
						>
						<span> : {experience[0].company}</span>
					</div>
					<div>
						<span class="text-ctp-blue"
							><i class="nf nf-md-school"></i> Education</span
						>
						<span> : {education[0].institution}</span>
					</div>
					<div>
						<span class="text-ctp-blue"
							><i class="nf nf-md-briefcase"></i> Experience</span
						>
						<span> : 5 years, 4 clients, 8 projects</span>
					</div>
					<div>
						<span class="text-ctp-blue"
							><i class="nf nf-md-file_document"></i> Articles</span
						>
						<span> : 2</span>
					</div>
					<div>
						<span class="text-ctp-blue"
							><i class="nf nf-md-clock"></i> Uptime</span
						>
						<span> : </span><span id="uptime">Loading...</span>
					</div>
					<div>
						<DiscordStatus
							client:load
							userId={import.meta.env.DISCORD_USER_ID}
							socketUrl={import.meta.env.LANYARD_SOCKET_URL}
						/>
					</div>
					<div class="text-ctp-overlay1">
						--------------------------
					</div>
					<div class="mt-2 flex gap-3 select-none">
						<span class="w-3 h-3 rounded-full bg-ctp-black"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-red"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-green"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-yellow"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-blue"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-mauve"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-teal"></span>
						<span class="w-3 h-3 rounded-full bg-ctp-text"></span>
					</div>
				</div>
			</div>

			<div class="mt-4"></div>
		</div>
	</div>

	<script>
		// Typewriter animation
		const text = "fastfetch";
		const typewriter = document.getElementById("typewriter");
		const fetchOutput = document.getElementById("fetch-output");
		const cursor = document.getElementById("cursor");
		let i = 0;

		function type() {
			if (i < text.length) {
				typewriter.textContent += text.charAt(i);
				i++;
				setTimeout(type, 50 + Math.random() * 50);
			} else {
				setTimeout(() => {
					if (fetchOutput) fetchOutput.classList.remove("hidden");
					if (cursor) cursor.style.display = "none"; // Hide cursor after typing
				}, 500);
			}
		}

		// Start typing after a short delay
		setTimeout(type, 200);

		// Uptime Logic
		function updateUptime() {
			const birthDate = new Date("2004-04-15T05:30:00");
			const now = new Date();

			let years = now.getFullYear() - birthDate.getFullYear();
			let months = now.getMonth() - birthDate.getMonth();
			let days = now.getDate() - birthDate.getDate();

			if (days < 0) {
				months--;
				// Get days in previous month
				const prevMonth = new Date(
					now.getFullYear(),
					now.getMonth(),
					0,
				);
				days += prevMonth.getDate();
			}

			if (months < 0) {
				years--;
				months += 12;
			}

			const uptimeElement = document.getElementById("uptime");
			if (uptimeElement) {
				uptimeElement.textContent = `${years} years, ${months} months, ${days} days`;
			}
		}

		setInterval(updateUptime, 86400000);
		updateUptime();
	</script>
</Layout>
