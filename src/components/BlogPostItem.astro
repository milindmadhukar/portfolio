---
import { formatDateCompact, formatWordCount } from '../utils/date';

interface Props {
  title: string;
  description: string;
  date: Date;
  tags: string[];
  url: string;
  cover?: string | any;
  draft?: boolean;
  index: number;
  wordCount: number;
}

const { title, description, date, tags, url, cover, draft = false, index, wordCount } = Astro.props;

// Helper function to get terminal color class based on index
function getTerminalColor(idx: number): string {
  const colors = ['cyber-cyan', 'cyber-purple', 'cyber-pink', 'neon-green'];
  return colors[idx % colors.length];
}

// Helper function to get icon for each blog post
function getPostIcon(idx: number): string {
  const icons = ['markdown', 'readme', 'git', 'vim', 'gnubash', 'linux'];
  return icons[idx % icons.length];
}

// Helper function to get word count color based on count
function getWordCountColor(count: number): string {
  if (count < 500) return 'text-blue-400';
  if (count < 1000) return 'text-purple-400';
  if (count < 2000) return 'text-pink-400';
  if (count < 3000) return 'text-orange-400';
  return 'text-red-400';
}

const colorClass = getTerminalColor(index);
const isDraft = draft;
const formattedDate = formatDateCompact(date);
const wordCountFormatted = formatWordCount(wordCount);
const wordCountColor = getWordCountColor(wordCount);
// Extract cover URL - handle both string URLs and Astro Image objects
const coverUrl = typeof cover === 'string' ? cover : (cover?.src || '');
---

<div class="group relative blog-post-item" data-tags={JSON.stringify(tags)}>
  <a
    href={url}
    class="post-link block py-1.5 px-4 -mx-4 rounded hover:bg-[var(--bg-elevated)] transition-all duration-200"
    data-post-title={title}
    data-post-description={description}
    data-post-cover={coverUrl}
    data-post-tags={JSON.stringify(tags)}
  >
    <div class="grid grid-cols-[auto_auto_auto_auto_1fr] gap-4 items-center font-jetbrains">
      <!-- Permissions (colored by section) -->
      <span class="text-base">
        {isDraft ? (
          <><span class="text-gray-400">.</span><span class="text-yellow-400">rw-</span><span class="text-green-400">r--</span><span class="text-cyan-400">r--</span></>
        ) : (
          <><span class="text-blue-400">d</span><span class="text-yellow-400">rwx</span><span class="text-green-400">r-x</span><span class="text-cyan-400">r-x</span></>
        )}
      </span>

      <!-- Owner -->
      <span class="text-yellow-400 text-base">
        milind
      </span>

      <!-- Word Count -->
      <span class={`${wordCountColor} whitespace-nowrap text-base font-semibold`}>
        {wordCountFormatted}
      </span>

      <!-- Date -->
      <span class="text-green-400 whitespace-nowrap text-base">
        {formattedDate}
      </span>

      <!-- File name with icon and badges -->
      <div class="flex items-center gap-3 min-w-0">
        <img 
          src={`https://cdn.simpleicons.org/${getPostIcon(index)}`}
          alt=""
          class="w-5 h-5 flex-shrink-0 opacity-80"
          style="filter: brightness(0) saturate(100%) invert(100%);"
        />
        <span class={`text-white font-bold group-hover:underline decoration-${colorClass} transition-all text-base`}>
          {title}
        </span>
        {draft && (
          <span class="px-2 py-1 text-sm bg-terminal-yellow/20 text-terminal-yellow border border-terminal-yellow/50 rounded flex-shrink-0">
            draft
          </span>
        )}
      </div>
    </div>
  </a>
</div>
