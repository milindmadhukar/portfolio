---
import Layout from "../layouts/Layout.astro";
import { fetchGithubStats } from "../lib/github";
import { formatTimeAgo } from "../lib/date";
import TerminalPrompt from "../components/TerminalPrompt.astro";
import TerminalCommand from "../components/TerminalCommand.astro";
import DesktopTerminal from "../components/DesktopTerminal.astro";
import MobileTerminal from "../components/MobileTerminal.astro";
import DiscordStatus from "../components/DiscordStatus";
import SocialIcons from "../components/SocialIcons.astro";
import { personalInfo, experience, education } from "../lib/constants";

import {
	SOCIAL_CONFIG,
	TERMINAL_CONFIG,
	BIRTH_DATE,
	DISCORD_ID,
} from "../lib/constants";
import { getBlogPosts } from "../lib/blog";

export const prerender = false;

const githubStats = await fetchGithubStats();
const posts = getBlogPosts();
const latestPost = posts.length > 0 ? posts[0] : null;
---

<Layout title="portfolio@milind.dev" includePadding={false}>
	<!-- Mobile Terminal -->
	<div class="block lg:hidden pt-12 p-8">
		<MobileTerminal />
	</div>

	<!-- Desktop Terminal -->
	<div class="hidden lg:block">
		<DesktopTerminal />
	</div>

	<script define:vars={{ BIRTH_DATE }}>
		// Uptime Logic
		function updateUptime() {
			const birthDate = new Date(BIRTH_DATE);
			const now = new Date();

			let years = now.getFullYear() - birthDate.getFullYear();
			let months = now.getMonth() - birthDate.getMonth();
			let days = now.getDate() - birthDate.getDate();

			if (days < 0) {
				months--;
				// Get days in previous month
				const prevMonth = new Date(
					now.getFullYear(),
					now.getMonth(),
					0,
				);
				days += prevMonth.getDate();
			}

			if (months < 0) {
				years--;
				months += 12;
			}

			const uptimeElements = document.querySelectorAll(".uptime");
			uptimeElements.forEach((el) => {
				el.textContent = `${years} years, ${months} months, ${days} days`;
			});
		}

		setInterval(updateUptime, 86400000);
		updateUptime();
	</script>
</Layout>

<style>
	@media (min-width: 1024px) {
		body {
			overflow: hidden; /* Let the DesktopTerminal container handle scrolling */
		}
	}
</style>
